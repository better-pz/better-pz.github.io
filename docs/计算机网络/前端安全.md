# 前端安全

## xss

XSS (cross-site scripting 跨站脚本攻击),是一种代码注入的方式来进行攻击,攻击者通过在目标网站上注入恶意脚本,使之在用户的浏览器上运行,通过这些恶意代码可能会使项目崩溃,或者可以获取用的 cookie 信息,sessionID 等,进而危害数据安全,大致就是网网站至于 js 代码,网站在渲染的时候

### xss 的攻击方式

**1. 反射型**

发出请求时，XSS 代码出现在 URL 中，作为输入提交到服务器端,服务器端解析后响应，XSS 代码随响应内容一起传回给浏览器,最后浏览器解析执行 XSS 代码。这个过程像一次反射，故叫反射型 XSS。

- 写入后端接口,并关闭浏览器自动拦截 xss

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200330225133320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B6MTAyMQ==,size_16,color_FFFFFF,t_70)

- 在 url 中输入攻击的脚本

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020033022494918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B6MTAyMQ==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200330225041532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B6MTAyMQ==,size_16,color_FFFFFF,t_70)

**2. 存储型**

存储型 XSS 和反射型 XSS 的差别仅在于，提交的代码会存储在服务器端(数据库，内存，文件系统等)，下次请求目标页面时不用再提交 XSS 代码,黑客将恶意的`JavaScript`脚本长期保存在服务期端数据库中,用户一旦访问相关页面数据,恶意脚本就会被执行,常见于评论,文章等

存储型 xss 攻击步骤:

1. 攻击者将恶意代码提交到目标网站的数据库中
2. 用户打开目标网站页面,浏览器执行 js 代码
3. 执行到恶意代码用户冒充用户行为

**3. 基于 DOM 的 XSS 攻击**
网站 js 是可以改变 html 的,黑客可以用这一点来实现插入恶意脚本

基于 dom 的 xss 攻击步骤

1. 攻击者构造特殊的 URL,其中包括恶意代码
2. 用户打开带有恶意代码的 url
3. 用户浏览器接收响应后解析执行,前端 js 取出 url 中的恶意代码并执行
4. 恶意代码窃取用户数据

### XSS 防范措施

1. 编码 :对用户输入的数据进行 HTML Entity 编码
   ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200330230128505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B6MTAyMQ==,size_16,color_FFFFFF,t_70)
2. 过滤

- 移除用户.上传的 DOM 属性，如 onerror 等
- 移除用户.上传的 Style 节点、Script 节 点、Iframe 节点等

3. 校正

- 避免直接对 HTML Entity 解码
- 使用 DOM Parse 转换， 校正不配对的 DOM 标签

## csrf

通常称为跨站请求伪造，英文名 Cross-site request forgery 缩写 CSRF

**攻击步骤**:

- 受害者登录 A 网站,并保留了登录凭证（Cookie）
- 攻击者引诱受害者访问 B 网站
- A 网站向 B 网站发送一个请求(伪造请求),浏览器请求头中会默认携带 A 网站的 Cookie 来访问 B
- A 网站服务器收到请求后,经过验证发现用请求是携带 cookie 的,所以会正常处理请求

**攻击特点**

1. 攻击一般发起在第三方网站,我不是被攻击的网站,被攻击的网站无法防止攻击发生
2. 攻击利用受害者在被攻击网站的登录凭证,冒充受害者提交操作并不是直接窃取数据
3. 整个过程攻击者并不能获取到被攻击者的登录凭证,仅仅是冒用
4. 跨站请求可以用各种方式:图片,超链接,等,部分请求方式可以直接嵌入在第三方论坛、文章中,难以追踪

### 常见的 csrf 攻击类型

1. get 类型的 csrf

get 类型的 csrf 利用非常简单，只需要 http 请求，一般会这样利用：

```html
<img src="http://bank.example/withdraw?amount=10000&for=hacker" />
```

受害者访问含有这个 img 页面后，浏览器会向`http://bank.example/withdraw?amount=10000&for=hacker`发送一次 http 请求,`bank.example`就会收到包含受害者登录信息的一次跨域请求

2. post 类型的 csrf

这种类型一般就是使用一个自动提交的表单,如:

```html
<form action="http://bank.example/withdraw" method="POST">
  <input type="hidden" name="account" value="xiaoming" />
  <input type="hidden" name="amount" value="10000" />
  <input type="hidden" name="for" value="hacker" />
</form>
<script>
  document.forms[0].submit();
</script>
```

访问这个页面的时候,表单就会自动提交,用户自动执行了一次 post 操作

3. 链接类型的 csrf
   链接类型其实并不常见,这种需要引导用户点击链接才会触发,这种链接 2 通常是在论坛中日发布的照片中嵌入了恶意链接,或者是广告的形式诱导用户点击

```html
<a
  href="http://test.com/csrf/withdraw.php?amount=1000&for=hacker"
  taget="_blank"
>
  重磅消息！！
  <a
/></a>
```

**攻击原理**

实现攻击的两大关键因素:

- 网站中的某个接口存在这种漏洞
- 用户确实在 A 注册网站确实的登录过
  ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200330221721613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B6MTAyMQ==,size_16,color_FFFFFF,t_70)

### CSRF 防御措施

csrf 通常发生在第三方域名,并且 csrf 攻击者不能喝获取到受害者的 cookie 等信息,只是借用他们的登录状态来仿造请求,可以利用这两个特点来进行防范措施

- Token 验证
- Referer 验证
- 隐藏令牌
